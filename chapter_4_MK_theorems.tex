%!TEX root = main.tex










\begin{lemma}[Infinitely extended kernels]\label{lem:infinitely_extended_kernels}
Given a collection of Markov kernels $\kernel{K}_i:X^i\kto Y^i$ for all $i\in \mathbb{N}$, if we have for every $j>i$
\begin{align}
	\kernel{K}_j(\text{id}_{X_i}\otimes \text{del}_{X_{j-i}}) &= \kernel{K}_i\otimes \text{del}_{X_{j-i}}\label{eq:marginalise_comb}
\end{align} 
then there is a unique Markov kernel $\kernel{K}:X^{\mathbb{N}}\kto Y^{\mathbb{N}}$ such that for all $i,j\in \mathbb{N}$,$j>i$
\begin{align}
	\kernel{K}(\text{id}_{X_i}\otimes \text{del}_{X_{j-i}})&= \kernel{K}_i\otimes \text{del}_{X_{j-i}}
\end{align}
\end{lemma}

\begin{proof}
Take any $x\in X^{\mathbb{N}}$ and let $x_{|m}\in X^n$ be the first $n$ elements of $x$. By Equation \ref{eq:marginalise_comb}, for any $A_i\in \sigalg{Y}$, $i\in [m]$

\begin{align}
    \kernel{K}_n(\bigtimes_{i\in [m]}A_i\times Y^{n-m}|x_{|n}) &= \kernel{K}_m(\bigtimes_{i\in [m]}A_i|x_{|m})
\end{align}

Furthermore, by the definition of the $\mathrm{swap}$ map for any permutation $\rho:[n]\to[n]$
\begin{align}
    \kernel{K}_n\mathrm{swap}_{\rho}(\bigtimes_{i\in [m]}A_{\rho(i)}\times Y^{n-m}|x_{|n}) &= \kernel{K}_n(\bigtimes_{i\in [m]}A_{i}\times Y^{n-m}|x_{|n})
\end{align}

Thus by the Kolmogorov Extension Theorem \citep{cinlar_probability_2011}, for each $x\in X^{\mathbb{N}}$ there is a unique probability measure $\prob{Q}_x\in \Delta(Y^{\mathbb{N}}$ satisfying
\begin{align}
    \prob{Q}_d(\bigtimes_{i\in [n]}A_i\times Y^{\mathbb{N}}) &= \kernel{K}_n(\bigtimes_{i\in [n]}A_{\rho(i)}|d_{|n})\label{eq:q_is_Markov}
\end{align}

Furthermore, for each $\{A_i\in\sigalg{Y}|i\in \mathbb{N}\}$, $n\in \mathbb{N}$ note that for $p>n$

\begin{align}
\prob{Q}_d(\bigtimes_{i\in[n]} A_i \times Y^{\mathbb{N}})&\geq \prob{Q}_d(\bigtimes_{i\in [p]} A_i\times Y^{\mathbb{N}})\\
&\geq \prob{Q}_d(\bigtimes_{i\in \mathbb{N}} A_i)
\end{align}

so by the Monotone convergence theorem, the sequence $\prob{Q}_d(\bigtimes_{i\in[n]} A_i)$ converges as $n\to \infty$ to $\prob{Q}_d(\bigtimes_{i\in\mathbb{N}} A_i)$. $d\mapsto \prob{Q}_d^{\RV{Z}_n}(\bigtimes_{i\in[n]} A_i)$ is measurable for all $n$, $\{A_i\in\sigalg{Y}|i\in \mathbb{N}\}$ by Equation \ref{eq:q_is_Markov}, and so $d\mapsto Q_d$ is also measurable.

Thus $d\mapsto Q_d$ is the desired $\prob{P}_C^{\RV{Y}_{\mathbb{N}}\combbreak \RV{D}_{\mathbb{N}}}:D^\mathbb{N}\kto Y^\mathbb{N}$.
\end{proof}


\begin{theorem}[Conditional independence in augmented causally contractible model]
Suppose we have a probability set $\prob{P}_C$ on $\Omega$ with causally contractible $\mathbb{N}$-comb $\prob{P}_C^{\RV{Y}\combbreak \RV{D}}$, $\RV{Y}=(\RV{Y}_i)_{i\in\mathbb{N}}$, $\RV{D}=(\RV{D}_i)_{i\in\mathbb{N}}$, augmented with the hypothesis variable $\RV{H}$ as in Lemma \ref{lem:aug_cc}. Then for all $n$, $\RV{Y}_n\CI^e_{\prob{P}_C}(\RV{Y}_{<n},\RV{D}_{<n})|(\RV{H},\RV{D}_n)$.
\end{theorem}

\begin{proof}
For all $\alpha\in C$, $n\in \mathbb{N}$
\begin{align}
	\prob{P}_\alpha^{\RV{Y}_{[n]}\RV{D}_{[n]}|\RV{H}} &= \tikzfig{cc_comb_factorisation}
\end{align}
Thus for all $\alpha$, by Theorem \ref{th:higher_order_conditionals}
\begin{align}
	\prob{P}_C^{\RV{Y}_n|\RV{D}_n\RV{H}}\otimes \mathrm{del}_{D^{n-1}\times Y^{n-1}} \overset{\prob{P}_\alpha}{\cong} \prob{P}_C^{\RV{Y}_n|\RV{D}_{[n]}\RV{Y}_{<n}\RV{H}}
\end{align}
which implies $\RV{Y}_n\CI^e_{\prob{P}_C}(\RV{Y}_{<n},\RV{D}_{<n})|(\RV{H},\RV{D}_n)$.
\end{proof}


\begin{theorem}[Conditional independence in non-data-dependant causally contractible model]
Suppose we have a probability set $\prob{P}_C$ on $\Omega$ with causally contractible $\mathbb{N}$-comb $\prob{P}_C^{\RV{Y}\combbreak \RV{D}}$, $\RV{Y}=(\RV{Y}_i)_{i\in\mathbb{N}}$, $\RV{D}=(\RV{D}_i)_{i\in\mathbb{N}}$, augmented with the hypothesis variable $\RV{H}$ as in Lemma \ref{lem:aug_cc}. Then for all $n$, $\RV{Y}_n\CI^e_{\prob{P}_C}(\RV{Y}_{<n},\RV{D}_{<n})|(\RV{H},\RV{D}_n)$.
\end{theorem}

\begin{lemma}\label{lem:aug_cc}
Suppose we have a probability set $\prob{P}_C'$ on $(\Omega',\sigalg{F}')$ with causally contractible $\mathbb{N}$-comb $\prob{P}_C^{\prime \RV{Y}'\combbreak \RV{D}''}$, $\RV{Y}'=(\RV{Y}'_i)_{i\in\mathbb{N}}$, $\RV{D}'=(\RV{D}'_i)_{i\in\mathbb{N}}$. Then there exists $H$ and an \emph{augmented} model $\prob{P}_C$ on $(\Omega,\sigalg{F}):=((\Omega'\times H,\sigalg{F}'\otimes\sigalg{H})$ such that $\prob{P}_C\Pi_{\Omega'}=\prob{P}_C'$ and, defining $\RV{H}:\Omega'\times H\to H$ as the projection onto $H$,
\begin{align}
    \prob{P}_C^{\RV{Y}\combbreak \RV{D}} &= \tikzfig{do_model_representation}\label{eq:do_model_rep}
\end{align}
\end{lemma}

\begin{proof}
Let $H$ be the hypothesis space from Theorem \ref{th:ciid_rep_kernel} and $\prob{P}_C^{\RV{H}}$ be some directing random measure for $\prob{P}_C^{\prime \RV{Y}\combbreak \RV{D}}$. Then by Theorem \ref{eq:do_model_rep}, Equation \ref{eq:do_model_rep} holds. Furthermore, by equality of combs, we have for all $\alpha\in C$
\begin{align}
	\prob{P}_\alpha^{\RV{YD}} &= \prob{P}_\alpha^{\prime \RV{Y'D'}}
\end{align}

Define $\RV{W}':\Omega'\to \Omega'$ as the identity function on $\Omega'$, $\RV{W}:\Omega'\times H\to \Omega'$ as the projection to $\Omega'$. For each $\alpha\in C$, define $\prob{P}_\alpha$ by

\begin{align}
	\prob{P}_\alpha^{\RV{W}} &= \prob{P}_\alpha^{\RV{YD}}\odot \prob{P}_\alpha^{\prime \RV{W}'|\RV{Y'D'}} (\mathrm{del}_{Y^{\mathbb{N}D^{\mathbb{N}}H}}\otimes \mathrm{id}_{\Omega'})
\end{align}

Then

\begin{align}
	\prob{P}_\alpha^{\RV{W}} &= \prob{P}_\alpha\Pi_{\Omega'}\\
	&= \prob{P}_\alpha^{\prime \RV{Y'D'}}\odot \prob{P}_\alpha^{\prime \RV{W}'|\RV{Y'D'}}(\mathrm{del}_{Y^{\mathbb{N}D^{\mathbb{N}}H}}\otimes \mathrm{id}_{\Omega'})\\
	&= \prob{P}_\alpha^{\prime \RV{W}'}
\end{align}
\end{proof}